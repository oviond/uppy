{"version":3,"names":["h","UIPlugin","getFileTypeExtension","ScreenRecIcon","RecorderScreen","packageJson","locale","isScreenRecordingSupported","_navigator$mediaDevic","window","MediaRecorder","navigator","mediaDevices","getDisplayMedia","getMediaDevices","ScreenCapture","constructor","uppy","opts","protocol","location","id","title","type","icon","defaultLocale","defaultOptions","displayMediaConstraints","video","width","height","frameRate","ideal","max","cursor","displaySurface","userMediaConstraints","audio","preferredVideoMimeType","i18nInit","install","bind","setPluginState","render","start","stop","startRecording","stopRecording","submit","streamInterrupted","streamInactivated","captureActive","capturedMediaFile","log","streamActive","audioStreamActive","target","mount","undefined","uninstall","videoStream","unmount","Promise","reject","Error","selectAudioStreamSource","selectVideoStreamSource","then","res","parent","hideAllPanels","resolve","addEventListener","catch","err","screenRecError","userDenied","setTimeout","audioStream","getUserMedia","name","info","i18n","options","recordingChunks","isTypeSupported","mimeType","tracks","getVideoTracks","push","getAudioTracks","outputStream","MediaStream","recorder","event","data","recording","recordedVideo","getPluginState","stopped","getVideo","file","URL","createObjectURL","error","addFile","isRestriction","forEach","track","fileExtension","Date","now","blob","Blob","source","recorderState","_extends","onStartRecording","onStopRecording","onStop","onSubmit","stream","VERSION","version"],"sources":["ScreenCapture.jsx"],"sourcesContent":["import { h } from 'preact'\nimport { UIPlugin } from '@uppy/core'\nimport getFileTypeExtension from '@uppy/utils/lib/getFileTypeExtension'\nimport ScreenRecIcon from './ScreenRecIcon.jsx'\nimport RecorderScreen from './RecorderScreen.jsx'\n\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\n// Check if screen capturing is supported.\n// mediaDevices is supprted on mobile Safari, getDisplayMedia is not\nfunction isScreenRecordingSupported () {\n  return window.MediaRecorder && navigator.mediaDevices?.getDisplayMedia // eslint-disable-line compat/compat\n}\n\n// Adapted from: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\nfunction getMediaDevices () {\n  return window.MediaRecorder && navigator.mediaDevices // eslint-disable-line compat/compat\n}\n\n/**\n * Screen capture\n */\nexport default class ScreenCapture extends UIPlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.mediaDevices = getMediaDevices()\n    // eslint-disable-next-line no-restricted-globals\n    this.protocol = location.protocol === 'https:' ? 'https' : 'http'\n    this.id = this.opts.id || 'ScreenCapture'\n    this.title = this.opts.title || 'Screencast'\n    this.type = 'acquirer'\n    this.icon = ScreenRecIcon\n\n    this.defaultLocale = locale\n\n    // set default options\n    // https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints\n    const defaultOptions = {\n      // https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints#Properties_of_shared_screen_tracks\n      displayMediaConstraints: {\n        video: {\n          width: 1280,\n          height: 720,\n          frameRate: {\n            ideal: 3,\n            max: 5,\n          },\n          cursor: 'motion',\n          displaySurface: 'monitor',\n        },\n      },\n      // https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints/audio\n      userMediaConstraints: {\n        audio: true,\n      },\n      preferredVideoMimeType: 'video/webm',\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    // i18n\n    this.i18nInit()\n\n    // uppy plugin class related\n    this.install = this.install.bind(this)\n    this.setPluginState = this.setPluginState.bind(this)\n    this.render = this.render.bind(this)\n\n    // screen capturer related\n    this.start = this.start.bind(this)\n    this.stop = this.stop.bind(this)\n    this.startRecording = this.startRecording.bind(this)\n    this.stopRecording = this.stopRecording.bind(this)\n    this.submit = this.submit.bind(this)\n    this.streamInterrupted = this.streamInactivated.bind(this)\n\n    // initialize\n    this.captureActive = false\n    this.capturedMediaFile = null\n  }\n\n  install () {\n    if (!isScreenRecordingSupported()) {\n      this.uppy.log('Screen recorder access is not supported', 'warning')\n      return null\n    }\n\n    this.setPluginState({\n      streamActive: false,\n      audioStreamActive: false,\n    })\n\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n\n    return undefined\n  }\n\n  uninstall () {\n    if (this.videoStream) {\n      this.stop()\n    }\n\n    this.unmount()\n  }\n\n  start () {\n    if (!this.mediaDevices) {\n      return Promise.reject(new Error('Screen recorder access not supported'))\n    }\n\n    this.captureActive = true\n\n    this.selectAudioStreamSource()\n\n    return this.selectVideoStreamSource()\n      .then(res => {\n        // something happened in start -> return\n        if (res === false) {\n          // Close the Dashboard panel if plugin is installed\n          // into Dashboard (could be other parent UI plugin)\n          if (this.parent && this.parent.hideAllPanels) {\n            this.parent.hideAllPanels()\n            this.captureActive = false\n          }\n        }\n      })\n  }\n\n  selectVideoStreamSource () {\n    // if active stream available, return it\n    if (this.videoStream) {\n      return new Promise(resolve => resolve(this.videoStream))\n    }\n\n    // ask user to select source to record and get mediastream from that\n    // eslint-disable-next-line compat/compat\n    return this.mediaDevices.getDisplayMedia(this.opts.displayMediaConstraints)\n      .then((videoStream) => {\n        this.videoStream = videoStream\n\n        // add event listener to stop recording if stream is interrupted\n        this.videoStream.addEventListener('inactive', () => {\n          this.streamInactivated()\n        })\n\n        this.setPluginState({\n          streamActive: true,\n        })\n\n        return videoStream\n      })\n      .catch((err) => {\n        this.setPluginState({\n          screenRecError: err,\n        })\n\n        this.userDenied = true\n\n        setTimeout(() => {\n          this.userDenied = false\n        }, 1000)\n\n        return false\n      })\n  }\n\n  selectAudioStreamSource () {\n    // if active stream available, return it\n    if (this.audioStream) {\n      return new Promise(resolve => resolve(this.audioStream))\n    }\n\n    // ask user to select source to record and get mediastream from that\n    // eslint-disable-next-line compat/compat\n    return this.mediaDevices.getUserMedia(this.opts.userMediaConstraints)\n      .then((audioStream) => {\n        this.audioStream = audioStream\n\n        this.setPluginState({\n          audioStreamActive: true,\n        })\n\n        return audioStream\n      })\n      .catch((err) => {\n        if (err.name === 'NotAllowedError') {\n          this.uppy.info(this.i18n('micDisabled'), 'error', 5000)\n          this.uppy.log(this.i18n('micDisabled'), 'warning')\n        }\n        return false\n      })\n  }\n\n  startRecording () {\n    const options = {}\n    this.capturedMediaFile = null\n    this.recordingChunks = []\n    const { preferredVideoMimeType } = this.opts\n\n    this.selectVideoStreamSource()\n      .then((videoStream) => {\n        // Attempt to use the passed preferredVideoMimeType (if any) during recording.\n        // If the browser doesn't support it, we'll fall back to the browser default instead\n        if (preferredVideoMimeType\n            && MediaRecorder.isTypeSupported(preferredVideoMimeType)\n            && getFileTypeExtension(preferredVideoMimeType)) {\n          options.mimeType = preferredVideoMimeType\n        }\n\n        // prepare tracks\n        const tracks = [videoStream.getVideoTracks()[0]]\n\n        // merge audio if exits\n        if (this.audioStream) {\n          tracks.push(this.audioStream.getAudioTracks()[0])\n        }\n\n        // create new stream from video and audio\n        // eslint-disable-next-line compat/compat\n        this.outputStream = new MediaStream(tracks)\n\n        // initialize mediarecorder\n        // eslint-disable-next-line compat/compat\n        this.recorder = new MediaRecorder(this.outputStream, options)\n\n        // push data to buffer when data available\n        this.recorder.addEventListener('dataavailable', (event) => {\n          this.recordingChunks.push(event.data)\n        })\n\n        // start recording\n        this.recorder.start()\n\n        // set plugin state to recording\n        this.setPluginState({\n          recording: true,\n        })\n      })\n      .catch((err) => {\n        this.uppy.log(err, 'error')\n      })\n  }\n\n  streamInactivated () {\n    // get screen recorder state\n    const { recordedVideo, recording } = { ...this.getPluginState() }\n\n    if (!recordedVideo && !recording) {\n      // Close the Dashboard panel if plugin is installed\n      // into Dashboard (could be other parent UI plugin)\n      if (this.parent && this.parent.hideAllPanels) {\n        this.parent.hideAllPanels()\n      }\n    } else if (recording) {\n      // stop recorder if it is active\n      this.uppy.log('Capture stream inactive â€” stop recording')\n      this.stopRecording()\n    }\n\n    this.videoStream = null\n    this.audioStream = null\n\n    this.setPluginState({\n      streamActive: false, audioStreamActive: false,\n    })\n  }\n\n  stopRecording () {\n    const stopped = new Promise((resolve) => {\n      this.recorder.addEventListener('stop', () => {\n        resolve()\n      })\n\n      this.recorder.stop()\n    })\n\n    return stopped.then(() => {\n      // recording stopped\n      this.setPluginState({\n        recording: false,\n      })\n      // get video file after recorder stopped\n      return this.getVideo()\n    }).then((file) => {\n      // store media file\n      this.capturedMediaFile = file\n\n      // create object url for capture result preview\n      this.setPluginState({\n        // eslint-disable-next-line compat/compat\n        recordedVideo: URL.createObjectURL(file.data),\n      })\n    }).then(() => {\n      this.recordingChunks = null\n      this.recorder = null\n    }, (error) => {\n      this.recordingChunks = null\n      this.recorder = null\n      throw error\n    })\n  }\n\n  submit () {\n    try {\n      // add recorded file to uppy\n      if (this.capturedMediaFile) {\n        this.uppy.addFile(this.capturedMediaFile)\n      }\n    } catch (err) {\n      // Logging the error, exept restrictions, which is handled in Core\n      if (!err.isRestriction) {\n        this.uppy.log(err, 'warning')\n      }\n    }\n  }\n\n  stop () {\n    // flush video stream\n    if (this.videoStream) {\n      this.videoStream.getVideoTracks().forEach((track) => {\n        track.stop()\n      })\n      this.videoStream.getAudioTracks().forEach((track) => {\n        track.stop()\n      })\n      this.videoStream = null\n    }\n\n    // flush audio stream\n    if (this.audioStream) {\n      this.audioStream.getAudioTracks().forEach((track) => {\n        track.stop()\n      })\n      this.audioStream.getVideoTracks().forEach((track) => {\n        track.stop()\n      })\n      this.audioStream = null\n    }\n\n    // flush output stream\n    if (this.outputStream) {\n      this.outputStream.getAudioTracks().forEach((track) => {\n        track.stop()\n      })\n      this.outputStream.getVideoTracks().forEach((track) => {\n        track.stop()\n      })\n      this.outputStream = null\n    }\n\n    // remove preview video\n    this.setPluginState({\n      recordedVideo: null,\n    })\n\n    this.captureActive = false\n  }\n\n  getVideo () {\n    const mimeType = this.recordingChunks[0].type\n    const fileExtension = getFileTypeExtension(mimeType)\n\n    if (!fileExtension) {\n      return Promise.reject(new Error(`Could not retrieve recording: Unsupported media type \"${mimeType}\"`))\n    }\n\n    const name = `screencap-${Date.now()}.${fileExtension}`\n    const blob = new Blob(this.recordingChunks, { type: mimeType })\n    const file = {\n      source: this.id,\n      name,\n      data: new Blob([blob], { type: mimeType }),\n      type: mimeType,\n    }\n\n    return Promise.resolve(file)\n  }\n\n  render () {\n    // get screen recorder state\n    const recorderState = this.getPluginState()\n\n    if (!recorderState.streamActive && !this.captureActive && !this.userDenied) {\n      this.start()\n    }\n\n    return (\n      <RecorderScreen\n        {...recorderState} // eslint-disable-line react/jsx-props-no-spreading\n        onStartRecording={this.startRecording}\n        onStopRecording={this.stopRecording}\n        onStop={this.stop}\n        onSubmit={this.submit}\n        i18n={this.i18n}\n        stream={this.videoStream}\n      />\n    )\n  }\n}\n"],"mappings":";AAAA,SAASA,CAAC,QAAQ,QAAQ;AAC1B,SAASC,QAAQ,QAAQ,YAAY;AACrC,OAAOC,oBAAoB,MAAM,sCAAsC;AACvE,OAAOC,aAAa,MAAM,oBAAqB;AAC/C,OAAOC,cAAc,MAAM,qBAAsB;AAAA,MAE1CC,WAAW;EAAA;AAAA;AAClB,OAAOC,MAAM,MAAM,aAAa;;AAEhC;AACA;AACA,SAASC,0BAA0BA,CAAA,EAAI;EAAA,IAAAC,qBAAA;EACrC,OAAOC,MAAM,CAACC,aAAa,MAAAF,qBAAA,GAAIG,SAAS,CAACC,YAAY,qBAAtBJ,qBAAA,CAAwBK,eAAe,GAAC;AACzE;;AAEA;AACA,SAASC,eAAeA,CAAA,EAAI;EAC1B,OAAOL,MAAM,CAACC,aAAa,IAAIC,SAAS,CAACC,YAAY,EAAC;AACxD;;AAEA;AACA;AACA;AACA,eAAe,MAAMG,aAAa,SAASd,QAAQ,CAAC;EAGlDe,WAAWA,CAAEC,IAAI,EAAEC,IAAI,EAAE;IACvB,KAAK,CAACD,IAAI,EAAEC,IAAI,CAAC;IACjB,IAAI,CAACN,YAAY,GAAGE,eAAe,CAAC,CAAC;IACrC;IACA,IAAI,CAACK,QAAQ,GAAGC,QAAQ,CAACD,QAAQ,KAAK,QAAQ,GAAG,OAAO,GAAG,MAAM;IACjE,IAAI,CAACE,EAAE,GAAG,IAAI,CAACH,IAAI,CAACG,EAAE,IAAI,eAAe;IACzC,IAAI,CAACC,KAAK,GAAG,IAAI,CAACJ,IAAI,CAACI,KAAK,IAAI,YAAY;IAC5C,IAAI,CAACC,IAAI,GAAG,UAAU;IACtB,IAAI,CAACC,IAAI,GAAGrB,aAAa;IAEzB,IAAI,CAACsB,aAAa,GAAGnB,MAAM;;IAE3B;IACA;IACA,MAAMoB,cAAc,GAAG;MACrB;MACAC,uBAAuB,EAAE;QACvBC,KAAK,EAAE;UACLC,KAAK,EAAE,IAAI;UACXC,MAAM,EAAE,GAAG;UACXC,SAAS,EAAE;YACTC,KAAK,EAAE,CAAC;YACRC,GAAG,EAAE;UACP,CAAC;UACDC,MAAM,EAAE,QAAQ;UAChBC,cAAc,EAAE;QAClB;MACF,CAAC;MACD;MACAC,oBAAoB,EAAE;QACpBC,KAAK,EAAE;MACT,CAAC;MACDC,sBAAsB,EAAE;IAC1B,CAAC;;IAED;IACA,IAAI,CAACpB,IAAI,GAAG;MAAE,GAAGQ,cAAc;MAAE,GAAGR;IAAK,CAAC;;IAE1C;IACA,IAAI,CAACqB,QAAQ,CAAC,CAAC;;IAEf;IACA,IAAI,CAACC,OAAO,GAAG,IAAI,CAACA,OAAO,CAACC,IAAI,CAAC,IAAI,CAAC;IACtC,IAAI,CAACC,cAAc,GAAG,IAAI,CAACA,cAAc,CAACD,IAAI,CAAC,IAAI,CAAC;IACpD,IAAI,CAACE,MAAM,GAAG,IAAI,CAACA,MAAM,CAACF,IAAI,CAAC,IAAI,CAAC;;IAEpC;IACA,IAAI,CAACG,KAAK,GAAG,IAAI,CAACA,KAAK,CAACH,IAAI,CAAC,IAAI,CAAC;IAClC,IAAI,CAACI,IAAI,GAAG,IAAI,CAACA,IAAI,CAACJ,IAAI,CAAC,IAAI,CAAC;IAChC,IAAI,CAACK,cAAc,GAAG,IAAI,CAACA,cAAc,CAACL,IAAI,CAAC,IAAI,CAAC;IACpD,IAAI,CAACM,aAAa,GAAG,IAAI,CAACA,aAAa,CAACN,IAAI,CAAC,IAAI,CAAC;IAClD,IAAI,CAACO,MAAM,GAAG,IAAI,CAACA,MAAM,CAACP,IAAI,CAAC,IAAI,CAAC;IACpC,IAAI,CAACQ,iBAAiB,GAAG,IAAI,CAACC,iBAAiB,CAACT,IAAI,CAAC,IAAI,CAAC;;IAE1D;IACA,IAAI,CAACU,aAAa,GAAG,KAAK;IAC1B,IAAI,CAACC,iBAAiB,GAAG,IAAI;EAC/B;EAEAZ,OAAOA,CAAA,EAAI;IACT,IAAI,CAACjC,0BAA0B,CAAC,CAAC,EAAE;MACjC,IAAI,CAACU,IAAI,CAACoC,GAAG,CAAC,yCAAyC,EAAE,SAAS,CAAC;MACnE,OAAO,IAAI;IACb;IAEA,IAAI,CAACX,cAAc,CAAC;MAClBY,YAAY,EAAE,KAAK;MACnBC,iBAAiB,EAAE;IACrB,CAAC,CAAC;IAEF,MAAM;MAAEC;IAAO,CAAC,GAAG,IAAI,CAACtC,IAAI;IAC5B,IAAIsC,MAAM,EAAE;MACV,IAAI,CAACC,KAAK,CAACD,MAAM,EAAE,IAAI,CAAC;IAC1B;IAEA,OAAOE,SAAS;EAClB;EAEAC,SAASA,CAAA,EAAI;IACX,IAAI,IAAI,CAACC,WAAW,EAAE;MACpB,IAAI,CAACf,IAAI,CAAC,CAAC;IACb;IAEA,IAAI,CAACgB,OAAO,CAAC,CAAC;EAChB;EAEAjB,KAAKA,CAAA,EAAI;IACP,IAAI,CAAC,IAAI,CAAChC,YAAY,EAAE;MACtB,OAAOkD,OAAO,CAACC,MAAM,CAAC,IAAIC,KAAK,CAAC,sCAAsC,CAAC,CAAC;IAC1E;IAEA,IAAI,CAACb,aAAa,GAAG,IAAI;IAEzB,IAAI,CAACc,uBAAuB,CAAC,CAAC;IAE9B,OAAO,IAAI,CAACC,uBAAuB,CAAC,CAAC,CAClCC,IAAI,CAACC,GAAG,IAAI;MACX;MACA,IAAIA,GAAG,KAAK,KAAK,EAAE;QACjB;QACA;QACA,IAAI,IAAI,CAACC,MAAM,IAAI,IAAI,CAACA,MAAM,CAACC,aAAa,EAAE;UAC5C,IAAI,CAACD,MAAM,CAACC,aAAa,CAAC,CAAC;UAC3B,IAAI,CAACnB,aAAa,GAAG,KAAK;QAC5B;MACF;IACF,CAAC,CAAC;EACN;EAEAe,uBAAuBA,CAAA,EAAI;IACzB;IACA,IAAI,IAAI,CAACN,WAAW,EAAE;MACpB,OAAO,IAAIE,OAAO,CAACS,OAAO,IAAIA,OAAO,CAAC,IAAI,CAACX,WAAW,CAAC,CAAC;IAC1D;;IAEA;IACA;IACA,OAAO,IAAI,CAAChD,YAAY,CAACC,eAAe,CAAC,IAAI,CAACK,IAAI,CAACS,uBAAuB,CAAC,CACxEwC,IAAI,CAAEP,WAAW,IAAK;MACrB,IAAI,CAACA,WAAW,GAAGA,WAAW;;MAE9B;MACA,IAAI,CAACA,WAAW,CAACY,gBAAgB,CAAC,UAAU,EAAE,MAAM;QAClD,IAAI,CAACtB,iBAAiB,CAAC,CAAC;MAC1B,CAAC,CAAC;MAEF,IAAI,CAACR,cAAc,CAAC;QAClBY,YAAY,EAAE;MAChB,CAAC,CAAC;MAEF,OAAOM,WAAW;IACpB,CAAC,CAAC,CACDa,KAAK,CAAEC,GAAG,IAAK;MACd,IAAI,CAAChC,cAAc,CAAC;QAClBiC,cAAc,EAAED;MAClB,CAAC,CAAC;MAEF,IAAI,CAACE,UAAU,GAAG,IAAI;MAEtBC,UAAU,CAAC,MAAM;QACf,IAAI,CAACD,UAAU,GAAG,KAAK;MACzB,CAAC,EAAE,IAAI,CAAC;MAER,OAAO,KAAK;IACd,CAAC,CAAC;EACN;EAEAX,uBAAuBA,CAAA,EAAI;IACzB;IACA,IAAI,IAAI,CAACa,WAAW,EAAE;MACpB,OAAO,IAAIhB,OAAO,CAACS,OAAO,IAAIA,OAAO,CAAC,IAAI,CAACO,WAAW,CAAC,CAAC;IAC1D;;IAEA;IACA;IACA,OAAO,IAAI,CAAClE,YAAY,CAACmE,YAAY,CAAC,IAAI,CAAC7D,IAAI,CAACkB,oBAAoB,CAAC,CAClE+B,IAAI,CAAEW,WAAW,IAAK;MACrB,IAAI,CAACA,WAAW,GAAGA,WAAW;MAE9B,IAAI,CAACpC,cAAc,CAAC;QAClBa,iBAAiB,EAAE;MACrB,CAAC,CAAC;MAEF,OAAOuB,WAAW;IACpB,CAAC,CAAC,CACDL,KAAK,CAAEC,GAAG,IAAK;MACd,IAAIA,GAAG,CAACM,IAAI,KAAK,iBAAiB,EAAE;QAClC,IAAI,CAAC/D,IAAI,CAACgE,IAAI,CAAC,IAAI,CAACC,IAAI,CAAC,aAAa,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC;QACvD,IAAI,CAACjE,IAAI,CAACoC,GAAG,CAAC,IAAI,CAAC6B,IAAI,CAAC,aAAa,CAAC,EAAE,SAAS,CAAC;MACpD;MACA,OAAO,KAAK;IACd,CAAC,CAAC;EACN;EAEApC,cAAcA,CAAA,EAAI;IAChB,MAAMqC,OAAO,GAAG,CAAC,CAAC;IAClB,IAAI,CAAC/B,iBAAiB,GAAG,IAAI;IAC7B,IAAI,CAACgC,eAAe,GAAG,EAAE;IACzB,MAAM;MAAE9C;IAAuB,CAAC,GAAG,IAAI,CAACpB,IAAI;IAE5C,IAAI,CAACgD,uBAAuB,CAAC,CAAC,CAC3BC,IAAI,CAAEP,WAAW,IAAK;MACrB;MACA;MACA,IAAItB,sBAAsB,IACnB5B,aAAa,CAAC2E,eAAe,CAAC/C,sBAAsB,CAAC,IACrDpC,oBAAoB,CAACoC,sBAAsB,CAAC,EAAE;QACnD6C,OAAO,CAACG,QAAQ,GAAGhD,sBAAsB;MAC3C;;MAEA;MACA,MAAMiD,MAAM,GAAG,CAAC3B,WAAW,CAAC4B,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;MAEhD;MACA,IAAI,IAAI,CAACV,WAAW,EAAE;QACpBS,MAAM,CAACE,IAAI,CAAC,IAAI,CAACX,WAAW,CAACY,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACnD;;MAEA;MACA;MACA,IAAI,CAACC,YAAY,GAAG,IAAIC,WAAW,CAACL,MAAM,CAAC;;MAE3C;MACA;MACA,IAAI,CAACM,QAAQ,GAAG,IAAInF,aAAa,CAAC,IAAI,CAACiF,YAAY,EAAER,OAAO,CAAC;;MAE7D;MACA,IAAI,CAACU,QAAQ,CAACrB,gBAAgB,CAAC,eAAe,EAAGsB,KAAK,IAAK;QACzD,IAAI,CAACV,eAAe,CAACK,IAAI,CAACK,KAAK,CAACC,IAAI,CAAC;MACvC,CAAC,CAAC;;MAEF;MACA,IAAI,CAACF,QAAQ,CAACjD,KAAK,CAAC,CAAC;;MAErB;MACA,IAAI,CAACF,cAAc,CAAC;QAClBsD,SAAS,EAAE;MACb,CAAC,CAAC;IACJ,CAAC,CAAC,CACDvB,KAAK,CAAEC,GAAG,IAAK;MACd,IAAI,CAACzD,IAAI,CAACoC,GAAG,CAACqB,GAAG,EAAE,OAAO,CAAC;IAC7B,CAAC,CAAC;EACN;EAEAxB,iBAAiBA,CAAA,EAAI;IACnB;IACA,MAAM;MAAE+C,aAAa;MAAED;IAAU,CAAC,GAAG;MAAE,GAAG,IAAI,CAACE,cAAc,CAAC;IAAE,CAAC;IAEjE,IAAI,CAACD,aAAa,IAAI,CAACD,SAAS,EAAE;MAChC;MACA;MACA,IAAI,IAAI,CAAC3B,MAAM,IAAI,IAAI,CAACA,MAAM,CAACC,aAAa,EAAE;QAC5C,IAAI,CAACD,MAAM,CAACC,aAAa,CAAC,CAAC;MAC7B;IACF,CAAC,MAAM,IAAI0B,SAAS,EAAE;MACpB;MACA,IAAI,CAAC/E,IAAI,CAACoC,GAAG,CAAC,0CAA0C,CAAC;MACzD,IAAI,CAACN,aAAa,CAAC,CAAC;IACtB;IAEA,IAAI,CAACa,WAAW,GAAG,IAAI;IACvB,IAAI,CAACkB,WAAW,GAAG,IAAI;IAEvB,IAAI,CAACpC,cAAc,CAAC;MAClBY,YAAY,EAAE,KAAK;MAAEC,iBAAiB,EAAE;IAC1C,CAAC,CAAC;EACJ;EAEAR,aAAaA,CAAA,EAAI;IACf,MAAMoD,OAAO,GAAG,IAAIrC,OAAO,CAAES,OAAO,IAAK;MACvC,IAAI,CAACsB,QAAQ,CAACrB,gBAAgB,CAAC,MAAM,EAAE,MAAM;QAC3CD,OAAO,CAAC,CAAC;MACX,CAAC,CAAC;MAEF,IAAI,CAACsB,QAAQ,CAAChD,IAAI,CAAC,CAAC;IACtB,CAAC,CAAC;IAEF,OAAOsD,OAAO,CAAChC,IAAI,CAAC,MAAM;MACxB;MACA,IAAI,CAACzB,cAAc,CAAC;QAClBsD,SAAS,EAAE;MACb,CAAC,CAAC;MACF;MACA,OAAO,IAAI,CAACI,QAAQ,CAAC,CAAC;IACxB,CAAC,CAAC,CAACjC,IAAI,CAAEkC,IAAI,IAAK;MAChB;MACA,IAAI,CAACjD,iBAAiB,GAAGiD,IAAI;;MAE7B;MACA,IAAI,CAAC3D,cAAc,CAAC;QAClB;QACAuD,aAAa,EAAEK,GAAG,CAACC,eAAe,CAACF,IAAI,CAACN,IAAI;MAC9C,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC5B,IAAI,CAAC,MAAM;MACZ,IAAI,CAACiB,eAAe,GAAG,IAAI;MAC3B,IAAI,CAACS,QAAQ,GAAG,IAAI;IACtB,CAAC,EAAGW,KAAK,IAAK;MACZ,IAAI,CAACpB,eAAe,GAAG,IAAI;MAC3B,IAAI,CAACS,QAAQ,GAAG,IAAI;MACpB,MAAMW,KAAK;IACb,CAAC,CAAC;EACJ;EAEAxD,MAAMA,CAAA,EAAI;IACR,IAAI;MACF;MACA,IAAI,IAAI,CAACI,iBAAiB,EAAE;QAC1B,IAAI,CAACnC,IAAI,CAACwF,OAAO,CAAC,IAAI,CAACrD,iBAAiB,CAAC;MAC3C;IACF,CAAC,CAAC,OAAOsB,GAAG,EAAE;MACZ;MACA,IAAI,CAACA,GAAG,CAACgC,aAAa,EAAE;QACtB,IAAI,CAACzF,IAAI,CAACoC,GAAG,CAACqB,GAAG,EAAE,SAAS,CAAC;MAC/B;IACF;EACF;EAEA7B,IAAIA,CAAA,EAAI;IACN;IACA,IAAI,IAAI,CAACe,WAAW,EAAE;MACpB,IAAI,CAACA,WAAW,CAAC4B,cAAc,CAAC,CAAC,CAACmB,OAAO,CAAEC,KAAK,IAAK;QACnDA,KAAK,CAAC/D,IAAI,CAAC,CAAC;MACd,CAAC,CAAC;MACF,IAAI,CAACe,WAAW,CAAC8B,cAAc,CAAC,CAAC,CAACiB,OAAO,CAAEC,KAAK,IAAK;QACnDA,KAAK,CAAC/D,IAAI,CAAC,CAAC;MACd,CAAC,CAAC;MACF,IAAI,CAACe,WAAW,GAAG,IAAI;IACzB;;IAEA;IACA,IAAI,IAAI,CAACkB,WAAW,EAAE;MACpB,IAAI,CAACA,WAAW,CAACY,cAAc,CAAC,CAAC,CAACiB,OAAO,CAAEC,KAAK,IAAK;QACnDA,KAAK,CAAC/D,IAAI,CAAC,CAAC;MACd,CAAC,CAAC;MACF,IAAI,CAACiC,WAAW,CAACU,cAAc,CAAC,CAAC,CAACmB,OAAO,CAAEC,KAAK,IAAK;QACnDA,KAAK,CAAC/D,IAAI,CAAC,CAAC;MACd,CAAC,CAAC;MACF,IAAI,CAACiC,WAAW,GAAG,IAAI;IACzB;;IAEA;IACA,IAAI,IAAI,CAACa,YAAY,EAAE;MACrB,IAAI,CAACA,YAAY,CAACD,cAAc,CAAC,CAAC,CAACiB,OAAO,CAAEC,KAAK,IAAK;QACpDA,KAAK,CAAC/D,IAAI,CAAC,CAAC;MACd,CAAC,CAAC;MACF,IAAI,CAAC8C,YAAY,CAACH,cAAc,CAAC,CAAC,CAACmB,OAAO,CAAEC,KAAK,IAAK;QACpDA,KAAK,CAAC/D,IAAI,CAAC,CAAC;MACd,CAAC,CAAC;MACF,IAAI,CAAC8C,YAAY,GAAG,IAAI;IAC1B;;IAEA;IACA,IAAI,CAACjD,cAAc,CAAC;MAClBuD,aAAa,EAAE;IACjB,CAAC,CAAC;IAEF,IAAI,CAAC9C,aAAa,GAAG,KAAK;EAC5B;EAEAiD,QAAQA,CAAA,EAAI;IACV,MAAMd,QAAQ,GAAG,IAAI,CAACF,eAAe,CAAC,CAAC,CAAC,CAAC7D,IAAI;IAC7C,MAAMsF,aAAa,GAAG3G,oBAAoB,CAACoF,QAAQ,CAAC;IAEpD,IAAI,CAACuB,aAAa,EAAE;MAClB,OAAO/C,OAAO,CAACC,MAAM,CAAC,IAAIC,KAAK,CAAE,yDAAwDsB,QAAS,GAAE,CAAC,CAAC;IACxG;IAEA,MAAMN,IAAI,GAAI,aAAY8B,IAAI,CAACC,GAAG,CAAC,CAAE,IAAGF,aAAc,EAAC;IACvD,MAAMG,IAAI,GAAG,IAAIC,IAAI,CAAC,IAAI,CAAC7B,eAAe,EAAE;MAAE7D,IAAI,EAAE+D;IAAS,CAAC,CAAC;IAC/D,MAAMe,IAAI,GAAG;MACXa,MAAM,EAAE,IAAI,CAAC7F,EAAE;MACf2D,IAAI;MACJe,IAAI,EAAE,IAAIkB,IAAI,CAAC,CAACD,IAAI,CAAC,EAAE;QAAEzF,IAAI,EAAE+D;MAAS,CAAC,CAAC;MAC1C/D,IAAI,EAAE+D;IACR,CAAC;IAED,OAAOxB,OAAO,CAACS,OAAO,CAAC8B,IAAI,CAAC;EAC9B;EAEA1D,MAAMA,CAAA,EAAI;IACR;IACA,MAAMwE,aAAa,GAAG,IAAI,CAACjB,cAAc,CAAC,CAAC;IAE3C,IAAI,CAACiB,aAAa,CAAC7D,YAAY,IAAI,CAAC,IAAI,CAACH,aAAa,IAAI,CAAC,IAAI,CAACyB,UAAU,EAAE;MAC1E,IAAI,CAAChC,KAAK,CAAC,CAAC;IACd;IAEA,OACE5C,CAAA,CAACI,cAAc,EAAAgH,QAAA,KACTD,aAAa;MAAE;MACnBE,gBAAgB,EAAE,IAAI,CAACvE,cAAe;MACtCwE,eAAe,EAAE,IAAI,CAACvE,aAAc;MACpCwE,MAAM,EAAE,IAAI,CAAC1E,IAAK;MAClB2E,QAAQ,EAAE,IAAI,CAACxE,MAAO;MACtBkC,IAAI,EAAE,IAAI,CAACA,IAAK;MAChBuC,MAAM,EAAE,IAAI,CAAC7D;IAAY,EAC1B,CAAC;EAEN;AACF;AA9XqB7C,aAAa,CACzB2G,OAAO,GAAGrH,WAAW,CAACsH,OAAO"}