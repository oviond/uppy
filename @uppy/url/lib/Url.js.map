{"version":3,"names":["h","UIPlugin","RequestClient","toArray","UrlUI","forEachDroppedOrPastedUrl","packageJson","locale","UrlIcon","focusable","width","height","viewBox","d","fill","addProtocolToURL","url","protocolRegex","defaultProtocol","test","canHandleRootDrop","e","items","dataTransfer","urls","filter","item","kind","type","length","checkIfCorrectURL","protocol","match","getFileNameFromUrl","pathname","URL","substring","lastIndexOf","Url","constructor","uppy","opts","id","title","icon","defaultLocale","defaultOptions","i18nInit","hostname","companionUrl","Error","getMeta","bind","addFile","handleRootDrop","handleRootPaste","client","companionHeaders","companionCookiesRule","registerRequestClient","requestClientId","post","then","res","error","log","protocollessUrl","optionalMeta","undefined","info","i18n","meta","tagFile","source","name","data","size","isRemote","body","remote","fileId","err","isRestriction","message","details","clipboardData","render","install","target","mount","uninstall","unmount","VERSION","version","prototype"],"sources":["Url.jsx"],"sourcesContent":["import { h } from 'preact'\nimport { UIPlugin } from '@uppy/core'\nimport { RequestClient } from '@uppy/companion-client'\nimport toArray from '@uppy/utils/lib/toArray'\nimport UrlUI from './UrlUI.jsx'\nimport forEachDroppedOrPastedUrl from './utils/forEachDroppedOrPastedUrl.js'\n\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\nfunction UrlIcon () {\n  return (\n    <svg aria-hidden=\"true\" focusable=\"false\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">\n      <path d=\"M23.637 15.312l-2.474 2.464a3.582 3.582 0 01-.577.491c-.907.657-1.897.986-2.968.986a4.925 4.925 0 01-3.959-1.971c-.248-.329-.164-.902.165-1.149.33-.247.907-.164 1.155.164 1.072 1.478 3.133 1.724 4.618.656a.642.642 0 00.33-.328l2.473-2.463c1.238-1.313 1.238-3.366-.082-4.597a3.348 3.348 0 00-4.618 0l-1.402 1.395a.799.799 0 01-1.154 0 .79.79 0 010-1.15l1.402-1.394a4.843 4.843 0 016.843 0c2.062 1.805 2.144 5.007.248 6.896zm-8.081 5.664l-1.402 1.395a3.348 3.348 0 01-4.618 0c-1.319-1.23-1.319-3.365-.082-4.596l2.475-2.464.328-.328c.743-.492 1.567-.739 2.475-.657.906.165 1.648.574 2.143 1.314.248.329.825.411 1.155.165.33-.248.412-.822.165-1.15-.825-1.068-1.98-1.724-3.216-1.888-1.238-.247-2.556.082-3.628.902l-.495.493-2.474 2.464c-1.897 1.969-1.814 5.09.083 6.977.99.904 2.226 1.396 3.463 1.396s2.473-.492 3.463-1.395l1.402-1.396a.79.79 0 000-1.15c-.33-.328-.908-.41-1.237-.082z\" fill=\"#FF753E\" fill-rule=\"nonzero\" />\n    </svg>\n  )\n}\n\nfunction addProtocolToURL (url) {\n  const protocolRegex = /^[a-z0-9]+:\\/\\//\n  const defaultProtocol = 'http://'\n  if (protocolRegex.test(url)) {\n    return url\n  }\n\n  return defaultProtocol + url\n}\n\nfunction canHandleRootDrop (e) {\n  const items = toArray(e.dataTransfer.items)\n  const urls = items.filter((item) => item.kind === 'string'\n    && item.type === 'text/uri-list')\n  return urls.length > 0\n}\n\nfunction checkIfCorrectURL (url) {\n  if (!url) return false\n\n  const protocol = url.match(/^([a-z0-9]+):\\/\\//)[1]\n  if (protocol !== 'http' && protocol !== 'https') {\n    return false\n  }\n\n  return true\n}\n\nfunction getFileNameFromUrl (url) {\n  const { pathname } = new URL(url)\n  return pathname.substring(pathname.lastIndexOf('/') + 1)\n}\n\n/**\n * Url\n *\n */\nexport default class Url extends UIPlugin {\n  static VERSION = packageJson.version\n\n  static requestClientId = Url.name\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'Url'\n    this.title = this.opts.title || 'Link'\n    this.type = 'acquirer'\n    this.icon = () => <UrlIcon />\n\n    // Set default options and locale\n    this.defaultLocale = locale\n\n    const defaultOptions = {}\n\n    this.opts = { ...defaultOptions, ...opts }\n\n    this.i18nInit()\n\n    this.hostname = this.opts.companionUrl\n\n    if (!this.hostname) {\n      throw new Error('Companion hostname is required, please consult https://uppy.io/docs/companion')\n    }\n\n    // Bind all event handlers for referencability\n    this.getMeta = this.getMeta.bind(this)\n    this.addFile = this.addFile.bind(this)\n    this.handleRootDrop = this.handleRootDrop.bind(this)\n    this.handleRootPaste = this.handleRootPaste.bind(this)\n\n    this.client = new RequestClient(uppy, {\n      companionUrl: this.opts.companionUrl,\n      companionHeaders: this.opts.companionHeaders,\n      companionCookiesRule: this.opts.companionCookiesRule,\n    })\n\n    this.uppy.registerRequestClient(Url.requestClientId, this.client)\n  }\n\n  getMeta (url) {\n    return this.client.post('url/meta', { url })\n      .then((res) => {\n        if (res.error) {\n          this.uppy.log('[URL] Error:')\n          this.uppy.log(res.error)\n          throw new Error('Failed to fetch the file')\n        }\n        return res\n      })\n  }\n\n  async addFile (protocollessUrl, optionalMeta = undefined) {\n    const url = addProtocolToURL(protocollessUrl)\n    if (!checkIfCorrectURL(url)) {\n      this.uppy.log(`[URL] Incorrect URL entered: ${url}`)\n      this.uppy.info(this.i18n('enterCorrectUrl'), 'error', 4000)\n      return undefined\n    }\n\n    try {\n      const meta = await this.getMeta(url)\n\n      const tagFile = {\n        meta: optionalMeta,\n        source: this.id,\n        name: meta.name || getFileNameFromUrl(url),\n        type: meta.type,\n        data: {\n          size: meta.size,\n        },\n        isRemote: true,\n        body: {\n          url,\n        },\n        remote: {\n          companionUrl: this.opts.companionUrl,\n          url: `${this.hostname}/url/get`,\n          body: {\n            fileId: url,\n            url,\n          },\n          requestClientId: Url.requestClientId,\n        },\n      }\n\n      this.uppy.log('[Url] Adding remote file')\n      try {\n        return this.uppy.addFile(tagFile)\n      } catch (err) {\n        if (!err.isRestriction) {\n          this.uppy.log(err)\n        }\n        return err\n      }\n    } catch (err) {\n      this.uppy.log(err)\n      this.uppy.info({\n        message: this.i18n('failedToFetch'),\n        details: err,\n      }, 'error', 4000)\n      return err\n    }\n  }\n\n  handleRootDrop (e) {\n    forEachDroppedOrPastedUrl(e.dataTransfer, 'drop', (url) => {\n      this.uppy.log(`[URL] Adding file from dropped url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  handleRootPaste (e) {\n    forEachDroppedOrPastedUrl(e.clipboardData, 'paste', (url) => {\n      this.uppy.log(`[URL] Adding file from pasted url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  render () {\n    return <UrlUI i18n={this.i18n} addFile={this.addFile} />\n  }\n\n  install () {\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n\n// This is defined outside of the class body because it's not using `this`, but\n// we still want it available on the prototype so the Dashboard can access it.\nUrl.prototype.canHandleRootDrop = canHandleRootDrop\n"],"mappings":"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"}