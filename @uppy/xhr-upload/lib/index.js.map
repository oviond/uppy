{"version":3,"names":["BasePlugin","nanoid","EventManager","ProgressTimeout","RateLimitedQueue","internalRateLimitedQueue","NetworkError","isNetworkError","filterNonFailedFiles","filterFilesToEmitUploadStarted","packageJson","locale","buildResponseError","xhr","err","error","Error","Object","assign","data","request","setTypeInBlob","file","dataWithUpdatedType","slice","size","meta","type","defaultOptions","formData","fieldName","method","allowedMetaFields","responseUrlFieldName","bundle","headers","timeout","limit","withCredentials","responseType","getResponseData","responseText","JSON","parse","getResponseError","_","response","validateStatus","status","_uploadLocalFile","_classPrivateFieldLooseKey","_uploadBundle","_getCompanionClientArgs","_uploadFiles","_handleUpload","XHRUpload","constructor","uppy","opts","defineProperty","value","_uploadFiles2","_getCompanionClientArgs2","_uploadBundle2","_uploadLocalFile2","writable","fileIDs","length","log","files","getFilesByIds","filesFiltered","filesToEmit","emit","isSomeFileRemote","some","isRemote","TypeError","_classPrivateFieldLooseBase","id","defaultLocale","i18nInit","requests","undefined","uploaderEvents","create","getOptions","overrides","getState","xhrUpload","addMetadata","Array","isArray","keys","forEach","item","subItem","append","createFormDataUpload","formPost","FormData","name","createBundledUpload","options","install","capabilities","setState","individualCancellation","addUploader","uninstall","removeUploader","current","total","uploadStarted","Date","now","Promise","resolve","reject","XMLHttpRequest","eventManager","queuedRequest","timer","i18n","seconds","Math","ceil","upload","addEventListener","ev","loaded","progress","lengthComputable","getFile","uploader","bytesUploaded","bytesTotal","done","remove","body","uploadURL","uploadResp","open","toUpperCase","endpoint","run","currentOpts","header","setRequestHeader","send","abort","onFileRemove","onCancelAll","_ref","reason","optsFromState","emitError","on","_temp","_file$remote","remote","protocol","fieldname","metadata","fromEntries","map","httpMethod","useFormData","allSettled","i","getQueue","controller","AbortController","removedHandler","removedFile","uploadPromise","getRequestClientForFile","uploadRemoteFile","signal","wrapSyncFunction","off","priority","VERSION","version"],"sources":["index.ts"],"sourcesContent":["import BasePlugin from '@uppy/core/lib/BasePlugin.js'\nimport type { DefinePluginOpts, PluginOpts } from '@uppy/core/lib/BasePlugin.js'\nimport type { RequestClient } from '@uppy/companion-client'\nimport { nanoid } from 'nanoid/non-secure'\nimport EventManager from '@uppy/core/lib/EventManager.js'\nimport ProgressTimeout from '@uppy/utils/lib/ProgressTimeout'\nimport {\n  RateLimitedQueue,\n  internalRateLimitedQueue,\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore untyped\n} from '@uppy/utils/lib/RateLimitedQueue'\nimport NetworkError from '@uppy/utils/lib/NetworkError'\nimport isNetworkError from '@uppy/utils/lib/isNetworkError'\nimport {\n  filterNonFailedFiles,\n  filterFilesToEmitUploadStarted,\n} from '@uppy/utils/lib/fileFilters'\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore We don't want TS to generate types for the package.json\nimport type { Meta, Body, UppyFile } from '@uppy/utils/lib/UppyFile'\nimport type { State, Uppy } from '@uppy/core'\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore We don't want TS to generate types for the package.json\nimport packageJson from '../package.json'\nimport locale from './locale.ts'\n\ndeclare module '@uppy/utils/lib/UppyFile' {\n  // eslint-disable-next-line no-shadow, @typescript-eslint/no-unused-vars\n  export interface UppyFile<M extends Meta, B extends Body> {\n    // TODO: figure out what else is in this type\n    xhrUpload?: { headers: Record<string, string> }\n  }\n}\n\ndeclare module '@uppy/core' {\n  // eslint-disable-next-line no-shadow, @typescript-eslint/no-unused-vars\n  export interface State<M extends Meta, B extends Body> {\n    // TODO: figure out what else is in this type\n    xhrUpload?: { headers: Record<string, string> }\n  }\n}\n\nexport interface XhrUploadOpts<M extends Meta, B extends Body>\n  extends PluginOpts {\n  endpoint: string\n  method?: 'post' | 'put'\n  formData?: boolean\n  fieldName?: string\n  headers?:\n    | Record<string, string>\n    | ((file: UppyFile<M, B>) => Record<string, string>)\n  timeout?: number\n  limit?: number\n  responseType?: XMLHttpRequestResponseType\n  withCredentials?: boolean\n  validateStatus?: (\n    status: number,\n    body: string,\n    xhr: XMLHttpRequest,\n  ) => boolean\n  getResponseData?: (\n    body: string,\n    xhr: XMLHttpRequest,\n  ) => NonNullable<UppyFile<M, B>['response']>['body']\n  getResponseError?: (body: string, xhr: XMLHttpRequest) => Error | NetworkError\n  allowedMetaFields?: string[] | null\n  bundle?: boolean\n  responseUrlFieldName?: string\n}\n\nfunction buildResponseError(\n  xhr: XMLHttpRequest,\n  err?: string | Error | NetworkError,\n) {\n  let error = err\n  // No error message\n  if (!error) error = new Error('Upload error')\n  // Got an error message string\n  if (typeof error === 'string') error = new Error(error)\n  // Got something else\n  if (!(error instanceof Error)) {\n    error = Object.assign(new Error('Upload error'), { data: error })\n  }\n\n  if (isNetworkError(xhr)) {\n    error = new NetworkError(error, xhr)\n    return error\n  }\n\n  // @ts-expect-error request can only be set on NetworkError\n  // but we use NetworkError to distinguish between errors.\n  error.request = xhr\n  return error\n}\n\n/**\n * Set `data.type` in the blob to `file.meta.type`,\n * because we might have detected a more accurate file type in Uppy\n * https://stackoverflow.com/a/50875615\n */\nfunction setTypeInBlob<M extends Meta, B extends Body>(file: UppyFile<M, B>) {\n  const dataWithUpdatedType = file.data.slice(0, file.data.size, file.meta.type)\n  return dataWithUpdatedType\n}\n\nconst defaultOptions = {\n  formData: true,\n  fieldName: 'file',\n  method: 'post',\n  allowedMetaFields: null,\n  responseUrlFieldName: 'url',\n  bundle: false,\n  headers: {},\n  timeout: 30 * 1000,\n  limit: 5,\n  withCredentials: false,\n  responseType: '',\n  getResponseData(responseText) {\n    return JSON.parse(responseText)\n  },\n  getResponseError(_, response) {\n    let error = new Error('Upload error')\n\n    if (isNetworkError(response)) {\n      error = new NetworkError(error, response)\n    }\n\n    return error\n  },\n  validateStatus(status) {\n    return status >= 200 && status < 300\n  },\n} satisfies Partial<XhrUploadOpts<any, any>>\n\ntype Opts<M extends Meta, B extends Body> = DefinePluginOpts<\n  XhrUploadOpts<M, B>,\n  keyof typeof defaultOptions\n>\n\ninterface OptsWithHeaders<M extends Meta, B extends Body> extends Opts<M, B> {\n  headers: Record<string, string>\n}\n\nexport default class XHRUpload<\n  M extends Meta,\n  B extends Body,\n> extends BasePlugin<Opts<M, B>, M, B> {\n  // eslint-disable-next-line global-require\n  static VERSION = packageJson.version\n\n  requests: RateLimitedQueue\n\n  uploaderEvents: Record<string, EventManager<M, B> | null>\n\n  constructor(uppy: Uppy<M, B>, opts: XhrUploadOpts<M, B>) {\n    super(uppy, {\n      ...defaultOptions,\n      fieldName: opts.bundle ? 'files[]' : 'file',\n      ...opts,\n    })\n    this.type = 'uploader'\n    this.id = this.opts.id || 'XHRUpload'\n\n    this.defaultLocale = locale\n\n    this.i18nInit()\n\n    // Simultaneous upload limiting is shared across all uploads with this plugin.\n    if (internalRateLimitedQueue in this.opts) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore untyped internal\n      this.requests = this.opts[internalRateLimitedQueue]\n    } else {\n      this.requests = new RateLimitedQueue(this.opts.limit)\n    }\n\n    if (this.opts.bundle && !this.opts.formData) {\n      throw new Error(\n        '`opts.formData` must be true when `opts.bundle` is enabled.',\n      )\n    }\n\n    if (this.opts.bundle && typeof this.opts.headers === 'function') {\n      throw new Error(\n        '`opts.headers` can not be a function when the `bundle: true` option is set.',\n      )\n    }\n\n    if (opts?.allowedMetaFields === undefined && 'metaFields' in this.opts) {\n      throw new Error(\n        'The `metaFields` option has been renamed to `allowedMetaFields`.',\n      )\n    }\n\n    this.uploaderEvents = Object.create(null)\n  }\n\n  getOptions(file: UppyFile<M, B>): OptsWithHeaders<M, B> {\n    const overrides = this.uppy.getState().xhrUpload\n    const { headers } = this.opts\n\n    const opts = {\n      ...this.opts,\n      ...(overrides || {}),\n      ...(file.xhrUpload || {}),\n      headers: {},\n    }\n    // Support for `headers` as a function, only in the XHRUpload settings.\n    // Options set by other plugins in Uppy state or on the files themselves are still merged in afterward.\n    //\n    // ```js\n    // headers: (file) => ({ expires: file.meta.expires })\n    // ```\n    if (typeof headers === 'function') {\n      opts.headers = headers(file)\n    } else {\n      Object.assign(opts.headers, this.opts.headers)\n    }\n\n    if (overrides) {\n      Object.assign(opts.headers, overrides.headers)\n    }\n    if (file.xhrUpload) {\n      Object.assign(opts.headers, file.xhrUpload.headers)\n    }\n\n    return opts\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  addMetadata(\n    formData: FormData,\n    meta: State<M, B>['meta'],\n    opts: Opts<M, B>,\n  ): void {\n    const allowedMetaFields =\n      Array.isArray(opts.allowedMetaFields) ?\n        opts.allowedMetaFields\n      : Object.keys(meta) // Send along all fields by default.\n\n    allowedMetaFields.forEach((item) => {\n      const value = meta[item]\n      if (Array.isArray(value)) {\n        // In this case we don't transform `item` to add brackets, it's up to\n        // the user to add the brackets so it won't be overridden.\n        value.forEach((subItem) => formData.append(item, subItem))\n      } else {\n        formData.append(item, value as string)\n      }\n    })\n  }\n\n  createFormDataUpload(file: UppyFile<M, B>, opts: Opts<M, B>): FormData {\n    const formPost = new FormData()\n\n    this.addMetadata(formPost, file.meta, opts)\n\n    const dataWithUpdatedType = setTypeInBlob(file)\n\n    if (file.name) {\n      formPost.append(opts.fieldName, dataWithUpdatedType, file.meta.name)\n    } else {\n      formPost.append(opts.fieldName, dataWithUpdatedType)\n    }\n\n    return formPost\n  }\n\n  createBundledUpload(files: UppyFile<M, B>[], opts: Opts<M, B>): FormData {\n    const formPost = new FormData()\n\n    const { meta } = this.uppy.getState()\n    this.addMetadata(formPost, meta, opts)\n\n    files.forEach((file) => {\n      const options = this.getOptions(file)\n\n      const dataWithUpdatedType = setTypeInBlob(file)\n\n      if (file.name) {\n        formPost.append(options.fieldName, dataWithUpdatedType, file.name)\n      } else {\n        formPost.append(options.fieldName, dataWithUpdatedType)\n      }\n    })\n\n    return formPost\n  }\n\n  async #uploadLocalFile(file: UppyFile<M, B>, current: number, total: number) {\n    const opts = this.getOptions(file)\n    const uploadStarted = Date.now()\n\n    this.uppy.log(`uploading ${current} of ${total}`)\n    return new Promise((resolve, reject) => {\n      const data =\n        opts.formData ? this.createFormDataUpload(file, opts) : file.data\n\n      const xhr = new XMLHttpRequest()\n      const eventManager = new EventManager(this.uppy)\n      this.uploaderEvents[file.id] = eventManager\n      let queuedRequest: { abort: () => void; done: () => void }\n\n      const timer = new ProgressTimeout(opts.timeout, () => {\n        const error = new Error(\n          this.i18n('uploadStalled', {\n            seconds: Math.ceil(opts.timeout / 1000),\n          }),\n        )\n        this.uppy.emit('upload-stalled', error, [file])\n      })\n\n      const id = nanoid()\n\n      xhr.upload.addEventListener('loadstart', () => {\n        this.uppy.log(`[XHRUpload] ${id} started`)\n      })\n\n      xhr.upload.addEventListener('progress', (ev) => {\n        this.uppy.log(`[XHRUpload] ${id} progress: ${ev.loaded} / ${ev.total}`)\n        // Begin checking for timeouts when progress starts, instead of loading,\n        // to avoid timing out requests on browser concurrency queue\n        timer.progress()\n\n        if (ev.lengthComputable) {\n          this.uppy.emit('upload-progress', this.uppy.getFile(file.id), {\n            // TODO: do not send `uploader` in next major\n            // @ts-expect-error we can't type this and we should remove it\n            uploader: this,\n            uploadStarted,\n            bytesUploaded: ev.loaded,\n            bytesTotal: ev.total,\n          })\n        }\n      })\n\n      xhr.addEventListener('load', () => {\n        this.uppy.log(`[XHRUpload] ${id} finished`)\n        timer.done()\n        queuedRequest.done()\n        if (this.uploaderEvents[file.id]) {\n          this.uploaderEvents[file.id]!.remove()\n          this.uploaderEvents[file.id] = null\n        }\n\n        if (opts.validateStatus(xhr.status, xhr.responseText, xhr)) {\n          const body = opts.getResponseData(xhr.responseText, xhr)\n          const uploadURL = body[opts.responseUrlFieldName] as string\n\n          const uploadResp = {\n            status: xhr.status,\n            body,\n            uploadURL,\n          }\n\n          this.uppy.emit(\n            'upload-success',\n            this.uppy.getFile(file.id),\n            uploadResp,\n          )\n\n          if (uploadURL) {\n            this.uppy.log(`Download ${file.name} from ${uploadURL}`)\n          }\n\n          return resolve(file)\n        }\n        const body = opts.getResponseData(xhr.responseText, xhr)\n        const error = buildResponseError(\n          xhr,\n          opts.getResponseError(xhr.responseText, xhr),\n        )\n\n        const response = {\n          status: xhr.status,\n          body,\n        }\n\n        this.uppy.emit('upload-error', file, error, response)\n        return reject(error)\n      })\n\n      xhr.addEventListener('error', () => {\n        this.uppy.log(`[XHRUpload] ${id} errored`)\n        timer.done()\n        queuedRequest.done()\n        if (this.uploaderEvents[file.id]) {\n          this.uploaderEvents[file.id]!.remove()\n          this.uploaderEvents[file.id] = null\n        }\n\n        const error = buildResponseError(\n          xhr,\n          opts.getResponseError(xhr.responseText, xhr),\n        )\n        this.uppy.emit('upload-error', file, error)\n        return reject(error)\n      })\n\n      xhr.open(opts.method.toUpperCase(), opts.endpoint, true)\n      // IE10 does not allow setting `withCredentials` and `responseType`\n      // before `open()` is called.\n      xhr.withCredentials = opts.withCredentials\n      if (opts.responseType !== '') {\n        xhr.responseType = opts.responseType\n      }\n\n      queuedRequest = this.requests.run(() => {\n        // When using an authentication system like JWT, the bearer token goes as a header. This\n        // header needs to be fresh each time the token is refreshed so computing and setting the\n        // headers just before the upload starts enables this kind of authentication to work properly.\n        // Otherwise, half-way through the list of uploads the token could be stale and the upload would fail.\n        const currentOpts = this.getOptions(file)\n\n        Object.keys(currentOpts.headers).forEach((header) => {\n          xhr.setRequestHeader(header, currentOpts.headers[header])\n        })\n\n        xhr.send(data)\n\n        return () => {\n          timer.done()\n          xhr.abort()\n        }\n      })\n\n      eventManager.onFileRemove(file.id, () => {\n        queuedRequest.abort()\n        reject(new Error('File removed'))\n      })\n\n      eventManager.onCancelAll(file.id, ({ reason }) => {\n        if (reason === 'user') {\n          queuedRequest.abort()\n        }\n        reject(new Error('Upload cancelled'))\n      })\n    })\n  }\n\n  #uploadBundle(files: UppyFile<M, B>[]): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const { endpoint } = this.opts\n      const { method } = this.opts\n      const uploadStarted = Date.now()\n\n      const optsFromState = this.uppy.getState().xhrUpload\n      const formData = this.createBundledUpload(files, {\n        ...this.opts,\n        ...(optsFromState || {}),\n      })\n\n      const xhr = new XMLHttpRequest()\n\n      const emitError = (error: Error) => {\n        files.forEach((file) => {\n          this.uppy.emit('upload-error', file, error)\n        })\n      }\n\n      const timer = new ProgressTimeout(this.opts.timeout, () => {\n        const error = new Error(\n          this.i18n('uploadStalled', {\n            seconds: Math.ceil(this.opts.timeout / 1000),\n          }),\n        )\n        this.uppy.emit('upload-stalled', error, files)\n      })\n\n      xhr.upload.addEventListener('loadstart', () => {\n        this.uppy.log('[XHRUpload] started uploading bundle')\n        timer.progress()\n      })\n\n      xhr.upload.addEventListener('progress', (ev) => {\n        timer.progress()\n\n        if (!ev.lengthComputable) return\n\n        files.forEach((file) => {\n          this.uppy.emit('upload-progress', this.uppy.getFile(file.id), {\n            // TODO: do not send `uploader` in next major\n            // @ts-expect-error we can't type this and we should remove it\n            uploader: this,\n            uploadStarted,\n            bytesUploaded: (ev.loaded / ev.total) * (file.size as number),\n            bytesTotal: file.size as number,\n          })\n        })\n      })\n\n      xhr.addEventListener('load', () => {\n        timer.done()\n\n        if (this.opts.validateStatus(xhr.status, xhr.responseText, xhr)) {\n          const body = this.opts.getResponseData(xhr.responseText, xhr)\n          const uploadResp = {\n            status: xhr.status,\n            body,\n          }\n          files.forEach((file) => {\n            this.uppy.emit(\n              'upload-success',\n              this.uppy.getFile(file.id),\n              uploadResp,\n            )\n          })\n          return resolve()\n        }\n\n        const error =\n          this.opts.getResponseError(xhr.responseText, xhr) ||\n          new NetworkError('Upload error', xhr)\n        emitError(error)\n        return reject(error)\n      })\n\n      xhr.addEventListener('error', () => {\n        timer.done()\n\n        const error =\n          this.opts.getResponseError(xhr.responseText, xhr) ||\n          new Error('Upload error')\n        emitError(error)\n        return reject(error)\n      })\n\n      this.uppy.on('cancel-all', ({ reason } = {}) => {\n        if (reason !== 'user') return\n        timer.done()\n        xhr.abort()\n      })\n\n      xhr.open(method.toUpperCase(), endpoint, true)\n      // IE10 does not allow setting `withCredentials` and `responseType`\n      // before `open()` is called.\n      xhr.withCredentials = this.opts.withCredentials\n      if (this.opts.responseType !== '') {\n        xhr.responseType = this.opts.responseType\n      }\n\n      // In bundle mode headers can not be a function\n      const headers = this.opts.headers as Record<string, string>\n      Object.keys(headers).forEach((header) => {\n        xhr.setRequestHeader(header, headers[header] as string)\n      })\n\n      xhr.send(formData)\n    })\n  }\n\n  #getCompanionClientArgs(file: UppyFile<M, B>) {\n    const opts = this.getOptions(file)\n    const allowedMetaFields =\n      Array.isArray(opts.allowedMetaFields) ?\n        opts.allowedMetaFields\n        // Send along all fields by default.\n      : Object.keys(file.meta)\n    return {\n      ...file.remote?.body,\n      protocol: 'multipart',\n      endpoint: opts.endpoint,\n      size: file.data.size,\n      fieldname: opts.fieldName,\n      metadata: Object.fromEntries(\n        allowedMetaFields.map((name) => [name, file.meta[name]]),\n      ),\n      httpMethod: opts.method,\n      useFormData: opts.formData,\n      headers: opts.headers,\n    }\n  }\n\n  async #uploadFiles(files: UppyFile<M, B>[]) {\n    await Promise.allSettled(\n      files.map((file, i) => {\n        const current = i + 1\n        const total = files.length\n\n        if (file.isRemote) {\n          const getQueue = () => this.requests\n          const controller = new AbortController()\n\n          const removedHandler = (removedFile: UppyFile<M, B>) => {\n            if (removedFile.id === file.id) controller.abort()\n          }\n          this.uppy.on('file-removed', removedHandler)\n\n          const uploadPromise = this.uppy\n            .getRequestClientForFile<RequestClient<M, B>>(file)\n            .uploadRemoteFile(file, this.#getCompanionClientArgs(file), {\n              signal: controller.signal,\n              getQueue,\n            })\n\n          this.requests.wrapSyncFunction(\n            () => {\n              this.uppy.off('file-removed', removedHandler)\n            },\n            { priority: -1 },\n          )()\n\n          return uploadPromise\n        }\n\n        return this.#uploadLocalFile(file, current, total)\n      }),\n    )\n  }\n\n  #handleUpload = async (fileIDs: string[]) => {\n    if (fileIDs.length === 0) {\n      this.uppy.log('[XHRUpload] No files to upload!')\n      return\n    }\n\n    // No limit configured by the user, and no RateLimitedQueue passed in by a \"parent\" plugin\n    // (basically just AwsS3) using the internal symbol\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore untyped internal\n    if (this.opts.limit === 0 && !this.opts[internalRateLimitedQueue]) {\n      this.uppy.log(\n        '[XHRUpload] When uploading multiple files at once, consider setting the `limit` option (to `10` for example), to limit the number of concurrent uploads, which helps prevent memory and network issues: https://uppy.io/docs/xhr-upload/#limit-0',\n        'warning',\n      )\n    }\n\n    this.uppy.log('[XHRUpload] Uploading...')\n    const files = this.uppy.getFilesByIds(fileIDs)\n\n    const filesFiltered = filterNonFailedFiles(files)\n    const filesToEmit = filterFilesToEmitUploadStarted(filesFiltered)\n    this.uppy.emit('upload-start', filesToEmit)\n\n    if (this.opts.bundle) {\n      // if bundle: true, we don’t support remote uploads\n      const isSomeFileRemote = filesFiltered.some((file) => file.isRemote)\n      if (isSomeFileRemote) {\n        throw new Error(\n          'Can’t upload remote files when the `bundle: true` option is set',\n        )\n      }\n\n      if (typeof this.opts.headers === 'function') {\n        throw new TypeError(\n          '`headers` may not be a function when the `bundle: true` option is set',\n        )\n      }\n\n      await this.#uploadBundle(filesFiltered)\n    } else {\n      await this.#uploadFiles(filesFiltered)\n    }\n  }\n\n  install(): void {\n    if (this.opts.bundle) {\n      const { capabilities } = this.uppy.getState()\n      this.uppy.setState({\n        capabilities: {\n          ...capabilities,\n          individualCancellation: false,\n        },\n      })\n    }\n\n    this.uppy.addUploader(this.#handleUpload)\n  }\n\n  uninstall(): void {\n    if (this.opts.bundle) {\n      const { capabilities } = this.uppy.getState()\n      this.uppy.setState({\n        capabilities: {\n          ...capabilities,\n          individualCancellation: true,\n        },\n      })\n    }\n\n    this.uppy.removeUploader(this.#handleUpload)\n  }\n}\n"],"mappings":"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"}